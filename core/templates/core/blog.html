{% extends 'core/base.html' %}
{% load static %}

{% block title %}Blog - IDEASOPHIA{% endblock %}

{% block content %}
<!-- Blog Header -->
<section class="blog-header">
    <div class="container">
        <div class="header-content">
            
            <img class = 'header-icon' src="{% static 'core/images/Reading1.png' %}" alt="sophiaread" width="150">
            <h1>Blog & Articles</h1>
            <p class="header-subtitle">Growing Knowledge, One Article at a Time</p>
            <p class="header-description">
                Explore thoughts on AI, Physics, Astronomy, Philosophy, and the intersection of technology and science. 
                Join Sophia the Owl in discovering new ideas! ü¶â
            </p>
        </div>
    </div>
</section>

<section class="blog-page">
    <div class="container">
        <div class="blog-layout">
            <!-- Main Content -->
            <div class="blog-main">
                <!-- Search Bar -->
                <div class="blog-search">
                    <form method="get" action="{% url 'core:blog' %}">
                        <div class="search-wrapper">
                            <svg class="search-icon" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            <input type="text" name="search" placeholder="Search articles by title, content, or category..." 
                                   value="{{ search_query }}" class="search-input">
                            <button type="submit" class="search-btn">
                                <span>Search</span>
                            </button>
                        </div>
                    </form>
                </div>

                {% if search_query %}
                <div class="search-results-info">
                    <span class="results-icon">üîç</span>
                    <p>Found <strong>{{ page_obj.paginator.count }}</strong> result(s) for: <strong>"{{ search_query }}"</strong></p>
                    <a href="{% url 'core:blog' %}" class="clear-search">Clear Search</a>
                </div>
                {% endif %}

                <!-- Blog Posts Grid -->
                <div class="blog-posts-grid">
                    {% for post in page_obj %}
                    <article class="blog-card">
                        {% if post.is_featured %}
                        <div class="featured-ribbon">
                            <span>‚≠ê</span> Featured
                        </div>
                        {% endif %}
                        
                        <!-- Card Header -->
                        <div class="blog-card-header">
                            <span class="blog-category">
                                <span>{{ post.category.icon|default:"üìÅ" }}</span>
                                {{ post.category.name|default:"General" }}
                            </span>
                            <span class="blog-date">
                                üìÖ {{ post.published_at|date:"M d, Y"|default:post.created_at|date:"M d, Y" }}
                            </span>
                        </div>
                        
                        <!-- Card Content -->
                        <h2 class="blog-card-title">
                            <a href="{% url 'core:blog_detail' post.slug %}">{{ post.title }}</a>
                        </h2>
                        
                        <p class="blog-card-excerpt">{{ post.excerpt|truncatewords:35 }}</p>
                        
                        <!-- Card Footer -->
                        <div class="blog-card-footer">
                            <div class="post-meta">
                                <span class="author">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                        <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                                    </svg>
                                    {{ post.author.get_full_name|default:post.author.username }}
                                </span>
                                <span class="reading-time">
                                    üìñ {{ post.reading_time_minutes|default:5 }} min
                                </span>
                            </div>
                            <a href="{% url 'core:blog_detail' post.slug %}" class="read-more-btn">
                                Read Article ‚Üí
                            </a>
                        </div>
                    </article>
                    {% empty %}
                    <div class="no-posts">
                        <img class = 'no-posts-icon' src="{% static 'core/images/Thinking (1).png' %}" alt="sophiathink" width="150">
                        <h3>No Articles Found</h3>
                        <p>{% if search_query %}No articles match your search. Try different keywords!{% else %}No blog posts available yet. Check back soon!{% endif %}</p>
                        {% if search_query %}
                        <a href="{% url 'core:blog' %}" class="btn-primary">View All Articles</a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if page_obj.has_other_pages %}
                <nav class="pagination">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" 
                       class="page-link page-prev">
                        ‚Üê Previous
                    </a>
                    {% endif %}
                    
                    <div class="page-numbers">
                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <span class="page-number active">{{ num }}</span>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" 
                                   class="page-number">{{ num }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>
                    
                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}" 
                       class="page-link page-next">
                        Next ‚Üí
                    </a>
                    {% endif %}
                </nav>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <aside class="blog-sidebar">
                <!-- Categories Widget -->
                <div class="sidebar-widget">
                    <h3 class="widget-title">
                        <span>üìö</span> Categories
                    </h3>
                    <ul class="category-list">
                        <li>
                            <a href="{% url 'core:blog' %}" class="{% if not current_category %}active{% endif %}">
                                <span class="category-icon">üåø</span>
                                <span class="category-name">All Articles</span>
                                <span class="category-count">{{ page_obj.paginator.count }}</span>
                            </a>
                        </li>
                        {% for category in categories %}
                        <li>
                            <a href="?category={{ category.slug }}" class="{% if current_category == category.slug %}active{% endif %}">
                                <span class="category-icon">{{ category.icon|default:"üìÅ" }}</span>
                                <span class="category-name">{{ category.name }}</span>
                                <span class="category-count">{{ category.blogpost_set.count }}</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Recent Posts Widget -->
                <div class="sidebar-widget">
                    <h3 class="widget-title">
                        <span>üïí</span> Recent Posts
                    </h3>
                    <div class="recent-posts-list">
                        {% for post in recent_posts %}
                        <a href="{% url 'core:blog_detail' post.slug %}" class="recent-post-item">
                            <div class="recent-post-content">
                                <h4>{{ post.title|truncatewords:8 }}</h4>
                                <p class="recent-post-meta">
                                    <span>{{ post.published_at|date:"M d"|default:post.created_at|date:"M d" }}</span>
                                    <span>‚Ä¢</span>
                                    <span>{{ post.reading_time_minutes|default:5 }} min</span>
                                </p>
                            </div>
                        </a>
                        {% empty %}
                        <p class="no-recent">No recent posts</p>
                        {% endfor %}
                    </div>
                </div>

                <!-- Newsletter Widget (Optional) -->
                <div class="sidebar-widget newsletter-widget">
                    <h3 class="widget-title">
                        <span>üì¨</span> Stay Updated
                    </h3>
                    <p>Get notified about new articles and updates!</p>
                    <form class="newsletter-form" method="post" action="#">
                        {% csrf_token %}
                        <input type="email" name="email" placeholder="Your email..." required>
                        <button type="submit" class="btn-subscribe">Subscribe</button>
                    </form>
                </div>

                <!-- Tags Widget (Optional) -->
                <div class="sidebar-widget">
                    <h3 class="widget-title">
                        <span>üè∑Ô∏è</span> Popular Tags
                    </h3>
                    <div class="tags-cloud">
                        <a href="#" class="tag">#AI</a>
                        <a href="#" class="tag">#MachineLearning</a>
                        <a href="#" class="tag">#Physics</a>
                        <a href="#" class="tag">#Astronomy</a>
                        <a href="#" class="tag">#Philosophy</a>
                        <a href="#" class="tag">#Python</a>
                        <a href="#" class="tag">#Django</a>
                        <a href="#" class="tag">#Science</a>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <div class="cta-content">
            <h2>Want to Contribute?</h2>
            <p>Have an interesting idea or topic? Let's collaborate and share knowledge! üìö</p>
            <a href="{% url 'core:contact' %}" class="btn-primary btn-large">Get In Touch</a>
        </div>
    </div>
</section>
{% endblock %}